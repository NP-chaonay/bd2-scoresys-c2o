# repo นี้สำหรับโค้ดฉบับผม ในการจำลองระบบประกาศผลสอบของโรงเรียนบดินทรเดชา (สิงห์ สิงหเสนี) ๒ 
## เงื่อนไข
- โดยออกแบบให้เรียบง่ายที่สุด UI ไม่หวือหวา โค้ดเข้าใจง่าย
- Backend:
  - Web Server: Python HTTP Server
  - Framework: แต่ใช้ CGI สำหรับโค้ดหลังบ้าน
  - Database: file-based โดยเก็บหลายไฟล์
  - การจำลองการดึงข้อมูลจากการอ่านกระดาษข้อสอบและการคีย์ข้อมูล: ตัว input คิดไม่ออกครับ... ส่วนการคีย์ข้อมูล จะทำเป็น python webserver + pure website ตอน output จะ out ไปที่ database folder
- Frontend:
  - Framework: ไม่มีครับ เป็น pure web
- frontend API ที่สร้างขึ้น จะต้อง compatible กับระบบจริง (frontend API ระบบจริง มาใช้ในนี้ไม่ได้ แต่ API ที่ผมสร้าง ต้องใช้ในระบบจริงได้55) 
  - หากสงสัยว่าหากมีการเปลี่ยนรหัสจะทำยังไง... ต้องเปลี่ยนชื่อไฟล์หรอ เนื่องจาก hash ที่ใช้แค่ 5 หลัก นั้นนำรหัสมาพิจารณาด้วย
    - คือแบบนี้ครับ ส่วนของ hash ใน path ที่ request จาก API เก่านั้น จะไม่ถูกนำมาประมวลผลในการเรียกข้อมูลจาก database
      - เพราะชื่อไฟล์ในฐานข้อมูลจริง ไม่อยากให้เกี่ยวข้องกับ hash เก่า เพื่อป้องกันการ reverse hash จากรหัสง่าย ๆ
      - แต่เพื่อให้ compatible กับ API เก่าได้ ระบบผมจะต้องสั่งให้ส่ง hash ของ path แบบเก่าไว้ เพื่อใช้กับระบบจริงได้ เพียงแค่ระบบจะไม่สนใจ
    - สิ่งที่จะใช้ยืนยันตัวตนแทน hash ใน path ของระบบเก่า คือการแนบ token+timestamp ใน query parameter
      - โดยหลักการคือ hash ของ username+hash-ของ-password+timestamp
      - เหตุผลที่ต้องแนบ timestamp เพราะว่าป้องกันการ replay หากลิงก์รั่ว โดย timestamp ที่ป้อนจะต้องอยู่ในช่วงไม่เกิน 5 นาที ที่ห่างจากตอนที่เซิฟรับคำขอ ... ทำให้ลิงก์มีการหมดอายุ
      - แถม token ต้องยาวพอกัน bruceforce ระยะสั้นด้วย
      - และหากนำ query param ไปใช้กับระบบจริง จะไม่มีอะไรเกิดขึ้น >> compatible yeahๆ
    - ส่วนชื่อไฟล์ในฐานข้อมูลจริง ตัว hash ให้สร้างจาก password ว่างเปล่า เพื่อป้องกันการ reverse hash
- gimmick:
  - ถ้าได้คะแนน 100% เต็ม จะเล่นท่อนหนึ่งของเพลงประจำสถาบันลำดับที่ 1 "มาร์ชบดินทรเดชาสอง" เป็นช่วงท้าย ๆ ของท่อน "บรรเลงต้นเพลง"
  - ถ้าได้ <50% จะเล่นท่อนหนึ่งของเพลงประจำสถาบันลำดับที่ 14 "ลาแล้วบดินทรสอง" เป็นช่วงต้น ๆ ของท่อนแรกของเนื้อร้อง
  - ปล: ref เพลงจากที่ self-host ที่[เว็บส่วนตัว](https://npchaonay.org/files/%E0%B9%80%E0%B8%9E%E0%B8%A5%E0%B8%87%E0%B8%9B%E0%B8%A3%E0%B8%B0%E0%B8%88%E0%B8%B3%E0%B8%AA%E0%B8%96%E0%B8%B2%E0%B8%9A%E0%B8%B1%E0%B8%99-%E0%B8%9A%E0%B8%94-%E0%B8%AA%E0%B8%AD%E0%B8%87/?fromNPcRef=github&whatGithub=NPchaonay_bd2-scoresys-c2o) ... เอามาแปลงแล้วใช้กับระบบที่ path ที่กำหนด (ไม่ได้อัปไว้ในนี้)
- Security Concern:
  - มีระบบกัน bruteforce / rate-limit
  - ต้องแนบ token (อิงจาก userid/hash-of-password/timestamp) เพื่อรับข้อมูล และให้มีการ expire token ด้วยเทคนิคใด ๆ ทำให้ไม่สามารถเข้าถึงข้อมูลได้หลังผ่านไปสักระยะแม้รู้ลิงก์
  - สามารถเปลี่ยนรหัสได้ จากระบบหลังบ้าน (ไปแก้เอาที่ไฟล์ใน database folder.... ระบบนี้ไม่ได้จำลองระบบบัญชีนักเรียน55)
  - permission เนื่องจากไม่ได้ใช้ production webserver จึงต้องแยกสิทธิ์
    - รัน webserver ผ่าน @ userA
    - ไฟล์เว็บและฐานข้อมูลทุกอย่าง ที่ไม่ใช่ไฟล์ข้อมูลรายนักเรียน ให้เห็นผ่าน userA แต่แก้ไขไม่ได้
    - ไฟล์ฐานข้อมูลรายนักเรียน ให้เห็นได้แค่ @ userB แต่ยังแก้ไขไม่ได้ ต้องแก้ผ่าน userC ... userB จะต้องรัน API program ไว้ทำการส่งข้อมูลไป webserver โดยจะต้องเช็คก่อนว่ารหัสถูกต้อง
    - userC ไว้รันโปรแกรมที่สามารถแก้ฐานข้อมูลได้
  - รหัสผ่าน เก็บเป็น hash และก่อนส่งไปหาเซิฟ ต้องส่งแบบ hash แล้วเท่านั้น
  - CORS เข้าใจว่า ปกติ browser มันจะ block อยู่แล้ว เลยไม่ได้กังวลตรงนี้
  - mTLS ไม่ได้ใช้ ใช้ password based แทน ก็เพียงพอๆ
  - ระบบนี้ตามสเปค ออกแบบให้รันผ่าน HTTPS หากมี intermediate gateway (เช่น Cloudflare) ต้องเป็นบริการที่ไว้ใจเท่านั้น เพื่อป้องกัน M-ia-M
## หมายเหตุ
- ที่สำคัญคือ ระบบนี้ไม่ใช่ระบบจริง และไม่มีส่วนเกี่ยวข้องกับระบบจริงของทางโรงเรียน
- ขอขอบคุณโค้ดอ้างอิงจากศิษย์เก่ารุ่นที่ 18 "Manatsawin Hanmongkolchai" ครับผม

> ปล ทำเป็นงานอดิเรกครับ 55
